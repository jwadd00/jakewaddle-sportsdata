---
title: Gathering Historical NFL Weather Data
author: Jake Waddle
date: '2020-09-28'
slug: gathering-historical-nfl-weather-data
categories:
  - R
tags:
  - NFL
  - Weather
  - Fantasy
description: ''
topics: []
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="warmish-welcome" class="section level1">
<h1>Warmish Welcome</h1>
<p>Fantasy sports are a passion of mine because they reside at the intersection of two of my favorite things in the world: sports and data. Over the last 4 or so years, I have built data sets suitable for modeling fantasy football and basketball outcomes. I tend to favor daily fantasy, but weather data is valuable for season long fantasy football as well.</p>
<p>In fantasy football, weather data are valuable for a variety of reasons. Conventional wisdom states temperature, wind, and precipation will affect throwing the football, the kicking game, holding on to the football, etc. After reading through this post, you will have the necessary data to explore these claims.</p>
<div id="setting-up" class="section level2">
<h2>Setting Up</h2>
<p>To start, we’ll load the necessary libraries. From there, we’ll find a website with weather data, write a function to scrape the data and then run that function on several web pages automatically to build a complete historical data set.</p>
<p>The website we will be using is <a href="http://nflweather.com/">NFL Weather</a>. Like most real-world exercises, the data is not presented to us in a perfectly built table. We’ll need to do a fair amount of data wrangling to mold the data into a useable structure.</p>
<pre class="r"><code># package management
library(tidyverse)
library(rvest)
library(janitor)</code></pre>
</div>
</div>
<div id="exploring-nflweather.com" class="section level1">
<h1>Exploring NFLWeather.com</h1>
<p>Once you navigate to <a href="http://nflweather.com/">NFL Weather</a>, you can see the weeks indexed with small blue boxes towards the top, directly in the middle of the page. Clicking on the ‘1’ takes you to the weather for week 1 of the 2020 season. Notice the url for this page: <a href="http://nflweather.com/en/week/2020/week-1/" class="uri">http://nflweather.com/en/week/2020/week-1/</a>. Simply replace ‘2020’ in the url with ‘2019’ will direct you to the week 1 forecast for the 2019 season. As you might have guessed, swapping ‘week-1’ with ‘week-8’ will launch the forecast for week 8. Already, we can see that the forecast for each week of a given season can be accessed programmatically simply by toggling a couple of paramters in the url (which we will do later on).</p>
<p>Let’s start with accessing the weather data for week 1 of the 2020 season. Using rvest, we can quickly scan the html for tables and parse appropriately using the <code>read_html()</code> and <code>html_table()</code> functions. These commands parse the html from the url given and return the tables in a list. Using <code>glimpse()</code>, we see that a list of 1 data frame that has some blank rows and null columns is returned. Sure, the data is a bit messy, but how slick is it that you can fetch data from a web page by simply using two commands from the <code>rvest</code> package.</p>
<pre class="r"><code>url &lt;- &#39;http://nflweather.com/en/week/2020/week-1/&#39;

url %&gt;% 
  read_html() %&gt;% 
  html_table() %&gt;%
  glimpse()</code></pre>
<pre><code>## List of 1
##  $ :&#39;data.frame&#39;:    16 obs. of  13 variables:
##   ..$                  : logi [1:16] NA NA NA NA NA NA ...
##   ..$ Away             : chr [1:16] &quot;Texans&quot; &quot;Eagles&quot; &quot;Dolphins&quot; &quot;Packers&quot; ...
##   ..$ Game             : logi [1:16] NA NA NA NA NA NA ...
##   ..$ Game             : chr [1:16] &quot;@&quot; &quot;@&quot; &quot;@&quot; &quot;@&quot; ...
##   ..$ Game             : logi [1:16] NA NA NA NA NA NA ...
##   ..$ Home             : chr [1:16] &quot;Chiefs&quot; &quot;Redskins&quot; &quot;Patriots&quot; &quot;Vikings&quot; ...
##   ..$ Time (ET)        : chr [1:16] &quot;Final: 20 - 34&quot; &quot;Final: 17 - 27&quot; &quot;Final: 11 - 21&quot; &quot;Final: 43 - 34&quot; ...
##   ..$ TV               : chr [1:16] &quot;NBC&quot; &quot;FOX&quot; &quot;CBS&quot; &quot;FOX&quot; ...
##   ..$                  : logi [1:16] NA NA NA NA NA NA ...
##   ..$ Forecast         : chr [1:16] &quot;58f Overcast&quot; &quot;76f Partly Cloudy&quot; &quot;73f Clear&quot; &quot;DOME&quot; ...
##   ..$ Extended Forecast: chr [1:16] &quot;Overcast. Rain in the morning and afternoon.&quot; &quot;Partly Cloudy. Clear throughout the day.&quot; &quot;Clear. Partly cloudy throughout the day.&quot; &quot;Clear. Clear throughout the day.&quot; ...
##   ..$ Wind             : chr [1:16] &quot;6m NNE&quot; &quot;4m S&quot; &quot;6m S&quot; &quot;2m SW&quot; ...
##   ..$                  : chr [1:16] &quot;Details&quot; &quot;Details&quot; &quot;Details&quot; &quot;Details&quot; ...</code></pre>
<div id="data-wrangling" class="section level2">
<h2>Data Wrangling</h2>
<p>We’ve returned the data frame we want, but definitely not the data frame we need. The initial output requires additional work.</p>
<p>We’ll use <code>clean_names()</code> from the <code>janitor</code> package to give each column a nice, clean name.</p>
<pre class="r"><code>url %&gt;% 
  read_html() %&gt;% 
  html_table() %&gt;%
  .[[1]] %&gt;%  # select the first and only element in the list 
  clean_names() %&gt;%
  glimpse()</code></pre>
<pre><code>## Rows: 16
## Columns: 13
## $ x                 &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
## $ away              &lt;chr&gt; &quot;Texans&quot;, &quot;Eagles&quot;, &quot;Dolphins&quot;, &quot;Packers&quot;, &quot;Colts...
## $ game              &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
## $ game_2            &lt;chr&gt; &quot;@&quot;, &quot;@&quot;, &quot;@&quot;, &quot;@&quot;, &quot;@&quot;, &quot;@&quot;, &quot;@&quot;, &quot;@&quot;, &quot;@&quot;, &quot;@&quot;,...
## $ game_3            &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
## $ home              &lt;chr&gt; &quot;Chiefs&quot;, &quot;Redskins&quot;, &quot;Patriots&quot;, &quot;Vikings&quot;, &quot;Jag...
## $ time_et           &lt;chr&gt; &quot;Final: 20 - 34&quot;, &quot;Final: 17 - 27&quot;, &quot;Final: 11 - ...
## $ tv                &lt;chr&gt; &quot;NBC&quot;, &quot;FOX&quot;, &quot;CBS&quot;, &quot;FOX&quot;, &quot;CBS&quot;, &quot;FOX&quot;, &quot;CBS&quot;, ...
## $ x_2               &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
## $ forecast          &lt;chr&gt; &quot;58f Overcast&quot;, &quot;76f Partly Cloudy&quot;, &quot;73f Clear&quot;,...
## $ extended_forecast &lt;chr&gt; &quot;Overcast. Rain in the morning and afternoon.&quot;, &quot;...
## $ wind              &lt;chr&gt; &quot;6m NNE&quot;, &quot;4m S&quot;, &quot;6m S&quot;, &quot;2m SW&quot;, &quot;8m ESE&quot;, &quot;11m...
## $ x_3               &lt;chr&gt; &quot;Details&quot;, &quot;Details&quot;, &quot;Details&quot;, &quot;Details&quot;, &quot;Deta...</code></pre>
<p>From there, we’ll select both home and away teams, the forecast, and the wind. The forecast field holds a description of the weather from which we can parse the temperature and precipiation out of.</p>
<pre class="r"><code>url %&gt;% 
  read_html() %&gt;% 
  html_table() %&gt;%
  .[[1]] %&gt;% 
  clean_names() %&gt;%
  select(away, home, forecast, wind)</code></pre>
<pre><code>##          away     home                    forecast    wind
## 1      Texans   Chiefs                58f Overcast  6m NNE
## 2      Eagles Redskins           76f Partly Cloudy    4m S
## 3    Dolphins Patriots                   73f Clear    6m S
## 4     Packers  Vikings                        DOME   2m SW
## 5       Colts  Jaguars 86f Humid and Mostly Cloudy  8m ESE
## 6       Bears    Lions                        DOME   11m W
## 7     Raiders Panthers                   79f Clear   3m NE
## 8        Jets    Bills                65f Overcast 12m SSW
## 9      Browns   Ravens           75f Partly Cloudy  5m SSE
## 10   Seahawks  Falcons                        DOME  3m ESE
## 11   Chargers  Bengals           83f Mostly Cloudy  4m WNW
## 12  Cardinals    49ers                   71f Clear   6m NW
## 13 Buccaneers   Saints                        DOME 10m ENE
## 14    Cowboys     Rams                        DOME    7m W
## 15   Steelers   Giants                   70f Clear 10m NNW
## 16     Titans  Broncos                   78f Foggy   7m NE</code></pre>
</div>
</div>
