<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.75.1" />

  <title>Gathering Historical NFL Weather Data &middot; Jake Waddle&#39;s Data Blog</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Blackburn</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/jake-waddle-88550565" rel="me" target="_blank"><i class="fab fa-linkedin"></i></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/jwadd00" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Gathering Historical NFL Weather Data</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>28 Sep 2020, 00:00</time>
  </div>

  

  
  
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/nfl">NFL</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/weather">Weather</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/fantasy">Fantasy</a>
    
  </div>
  
  

</div>

  
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<div id="warmish-welcome" class="section level1">
<h1>Warmish Welcome</h1>
<p>Fantasy sports are a passion of mine because they reside at the intersection of two of my favorite things in the world: sports and data. Over the last 4 or so years, I have built data sets suitable for modeling fantasy football and basketball outcomes. I tend to favor daily fantasy, but weather data is valuable for season long fantasy football as well.</p>
<p>In fantasy football, weather data are valuable for a variety of reasons. Conventional wisdom states temperature, wind, and precipation will affect throwing the football, the kicking game, holding on to the football, etc. After reading through this post, you will have the necessary data to explore these claims.</p>
<div id="setting-up" class="section level2">
<h2>Setting Up</h2>
<p>To start, we’ll load the necessary libraries. From there, we’ll find a website with weather data, write a function to scrape the data and then run that function on several web pages automatically to build a complete historical data set.</p>
<p>The website we will be using is <a href="http://nflweather.com/">NFL Weather</a>. Like most real-world exercises, the data is not presented to us in a perfectly built table. We’ll need to do a fair amount of data wrangling to mold the data into a useable structure.</p>
<pre class="r"><code># package management
library(tidyverse)
library(rvest)
library(janitor)
library(glue)</code></pre>
</div>
</div>
<div id="exploring-nflweather.com" class="section level1">
<h1>Exploring NFLWeather.com</h1>
<p>Once you navigate to <a href="http://nflweather.com/">NFL Weather</a>, you can see the weeks indexed with small blue boxes towards the top, directly in the middle of the page. Clicking on the ‘1’ takes you to the weather for week 1 of the 2020 season. Notice the url for this page: <a href="http://nflweather.com/en/week/2020/week-1/" class="uri">http://nflweather.com/en/week/2020/week-1/</a>. Simply replace ‘2020’ in the url with ‘2019’ will direct you to the week 1 forecast for the 2019 season. As you might have guessed, swapping ‘week-1’ with ‘week-8’ will launch the forecast for week 8. Already, we can see that the forecast for each week of a given season can be accessed by switching the year and week parts of the url.</p>
<p>Let’s start with accessing the weather data for week 1 of the 2020 season. Using rvest, we can quickly scan the html for tables and parse appropriately using the <code>read_html()</code> and <code>html_table()</code> functions. These commands parse the html from the url given and return the tables in a list. Using <code>glimpse()</code>, we see that a list of 1 data frame that has some blank rows and null columns is returned.</p>
<pre class="r"><code>url &lt;- &#39;http://nflweather.com/en/week/2020/week-1/&#39;

url %&gt;% 
  read_html() %&gt;% 
  html_table() %&gt;%
  glimpse()</code></pre>
<pre><code>## List of 1
##  $ :&#39;data.frame&#39;:    16 obs. of  13 variables:
##   ..$                  : logi [1:16] NA NA NA NA NA NA ...
##   ..$ Away             : chr [1:16] &quot;Texans&quot; &quot;Eagles&quot; &quot;Dolphins&quot; &quot;Packers&quot; ...
##   ..$ Game             : logi [1:16] NA NA NA NA NA NA ...
##   ..$ Game             : chr [1:16] &quot;@&quot; &quot;@&quot; &quot;@&quot; &quot;@&quot; ...
##   ..$ Game             : logi [1:16] NA NA NA NA NA NA ...
##   ..$ Home             : chr [1:16] &quot;Chiefs&quot; &quot;Washington&quot; &quot;Patriots&quot; &quot;Vikings&quot; ...
##   ..$ Time (ET)        : chr [1:16] &quot;Final: 20 - 34&quot; &quot;Final: 17 - 27&quot; &quot;Final: 11 - 21&quot; &quot;Final: 43 - 34&quot; ...
##   ..$ TV               : chr [1:16] &quot;NBC&quot; &quot;FOX&quot; &quot;CBS&quot; &quot;FOX&quot; ...
##   ..$                  : logi [1:16] NA NA NA NA NA NA ...
##   ..$ Forecast         : chr [1:16] &quot;58f Overcast&quot; &quot;76f Partly Cloudy&quot; &quot;73f Clear&quot; &quot;DOME&quot; ...
##   ..$ Extended Forecast: chr [1:16] &quot;Overcast. Rain in the morning and afternoon.&quot; &quot;Partly Cloudy. Clear throughout the day.&quot; &quot;Clear. Partly cloudy throughout the day.&quot; &quot;Clear. Clear throughout the day.&quot; ...
##   ..$ Wind             : chr [1:16] &quot;6m NNE&quot; &quot;4m S&quot; &quot;6m S&quot; &quot;2m SW&quot; ...
##   ..$                  : chr [1:16] &quot;Details&quot; &quot;Details&quot; &quot;Details&quot; &quot;Details&quot; ...</code></pre>
<div id="data-wrangling" class="section level2">
<h2>Data Wrangling</h2>
<p>We’ve returned the data frame we want, but definitely not the data frame we need. The initial output requires additional work.</p>
<p>We’ll use <code>clean_names()</code> from the <code>janitor</code> package to give each column a nice, clean name.</p>
<pre class="r"><code>url %&gt;% 
  read_html() %&gt;% 
  html_table() %&gt;%
  .[[1]] %&gt;%  # select the first and only element in the list 
  clean_names() %&gt;%
  kable(format = &#39;html&#39;) %&gt;% 
  kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
x
</th>
<th style="text-align:left;">
away
</th>
<th style="text-align:left;">
game
</th>
<th style="text-align:left;">
game_2
</th>
<th style="text-align:left;">
game_3
</th>
<th style="text-align:left;">
home
</th>
<th style="text-align:left;">
time_et
</th>
<th style="text-align:left;">
tv
</th>
<th style="text-align:left;">
x_2
</th>
<th style="text-align:left;">
forecast
</th>
<th style="text-align:left;">
extended_forecast
</th>
<th style="text-align:left;">
wind
</th>
<th style="text-align:left;">
x_3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Texans
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Chiefs
</td>
<td style="text-align:left;">
Final: 20 - 34
</td>
<td style="text-align:left;">
NBC
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
58f Overcast
</td>
<td style="text-align:left;">
Overcast. Rain in the morning and afternoon.
</td>
<td style="text-align:left;">
6m NNE
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Eagles
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Washington
</td>
<td style="text-align:left;">
Final: 17 - 27
</td>
<td style="text-align:left;">
FOX
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
76f Partly Cloudy
</td>
<td style="text-align:left;">
Partly Cloudy. Clear throughout the day.
</td>
<td style="text-align:left;">
4m S
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Dolphins
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Patriots
</td>
<td style="text-align:left;">
Final: 11 - 21
</td>
<td style="text-align:left;">
CBS
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
73f Clear
</td>
<td style="text-align:left;">
Clear. Partly cloudy throughout the day.
</td>
<td style="text-align:left;">
6m S
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Packers
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Vikings
</td>
<td style="text-align:left;">
Final: 43 - 34
</td>
<td style="text-align:left;">
FOX
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
Clear. Clear throughout the day.
</td>
<td style="text-align:left;">
2m SW
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Colts
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Jaguars
</td>
<td style="text-align:left;">
Final: 20 - 27
</td>
<td style="text-align:left;">
CBS
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
86f Humid and Mostly Cloudy
</td>
<td style="text-align:left;">
Humid and Mostly Cloudy. Rain until evening.
</td>
<td style="text-align:left;">
8m ESE
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Bears
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Lions
</td>
<td style="text-align:left;">
Final: 27 - 23
</td>
<td style="text-align:left;">
FOX
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
Clear. Rain in the morning.
</td>
<td style="text-align:left;">
11m W
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Raiders
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Panthers
</td>
<td style="text-align:left;">
Final: 34 - 30
</td>
<td style="text-align:left;">
CBS
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
79f Clear
</td>
<td style="text-align:left;">
Clear. Clear throughout the day.
</td>
<td style="text-align:left;">
3m NE
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Jets
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Bills
</td>
<td style="text-align:left;">
Final: 17 - 27
</td>
<td style="text-align:left;">
CBS
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
65f Overcast
</td>
<td style="text-align:left;">
Overcast. Rain in the morning and afternoon.
</td>
<td style="text-align:left;">
12m SSW
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Browns
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Ravens
</td>
<td style="text-align:left;">
Final: 6 - 38
</td>
<td style="text-align:left;">
CBS
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
75f Partly Cloudy
</td>
<td style="text-align:left;">
Partly Cloudy. Humid and partly cloudy throughout the day.
</td>
<td style="text-align:left;">
5m SSE
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Seahawks
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Falcons
</td>
<td style="text-align:left;">
Final: 38 - 25
</td>
<td style="text-align:left;">
FOX
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
Partly Cloudy. Partly cloudy throughout the day.
</td>
<td style="text-align:left;">
3m ESE
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Chargers
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Bengals
</td>
<td style="text-align:left;">
Final: 16 - 13
</td>
<td style="text-align:left;">
CBS
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
83f Mostly Cloudy
</td>
<td style="text-align:left;">
Mostly Cloudy. Possible drizzle in the morning.
</td>
<td style="text-align:left;">
4m WNW
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Cardinals
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
49ers
</td>
<td style="text-align:left;">
Final: 24 - 20
</td>
<td style="text-align:left;">
FOX
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
71f Clear
</td>
<td style="text-align:left;">
Clear. Clear throughout the day.
</td>
<td style="text-align:left;">
6m NW
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Buccaneers
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Saints
</td>
<td style="text-align:left;">
Final: 23 - 34
</td>
<td style="text-align:left;">
FOX
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
Humid and Partly Cloudy. Humid and partly cloudy throughout the day.
</td>
<td style="text-align:left;">
10m ENE
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Cowboys
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Rams
</td>
<td style="text-align:left;">
Final: 17 - 20
</td>
<td style="text-align:left;">
NBC
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
Clear. Clear throughout the day.
</td>
<td style="text-align:left;">
7m W
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Steelers
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Giants
</td>
<td style="text-align:left;">
Final: 26 - 16
</td>
<td style="text-align:left;">
ESPN
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
70f Clear
</td>
<td style="text-align:left;">
Clear. Clear throughout the day.
</td>
<td style="text-align:left;">
10m NNW
</td>
<td style="text-align:left;">
Details
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Titans
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
@
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Broncos
</td>
<td style="text-align:left;">
Final: 16 - 14
</td>
<td style="text-align:left;">
ESPN
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
78f Foggy
</td>
<td style="text-align:left;">
Foggy. Foggy throughout the day.
</td>
<td style="text-align:left;">
7m NE
</td>
<td style="text-align:left;">
Details
</td>
</tr>
</tbody>
</table>
<p>From there, we’ll select both home and away team columns, the forecast column, and the wind column. The forecast field holds a text description of the weather from which we can parse the temperature and precipiation out of.</p>
<pre class="r"><code>url %&gt;% 
  read_html() %&gt;% 
  html_table() %&gt;%
  .[[1]] %&gt;% 
  clean_names() %&gt;%
  select(away, home, forecast, wind) %&gt;% 
  kable(format = &#39;html&#39;) %&gt;% 
  kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
away
</th>
<th style="text-align:left;">
home
</th>
<th style="text-align:left;">
forecast
</th>
<th style="text-align:left;">
wind
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Texans
</td>
<td style="text-align:left;">
Chiefs
</td>
<td style="text-align:left;">
58f Overcast
</td>
<td style="text-align:left;">
6m NNE
</td>
</tr>
<tr>
<td style="text-align:left;">
Eagles
</td>
<td style="text-align:left;">
Washington
</td>
<td style="text-align:left;">
76f Partly Cloudy
</td>
<td style="text-align:left;">
4m S
</td>
</tr>
<tr>
<td style="text-align:left;">
Dolphins
</td>
<td style="text-align:left;">
Patriots
</td>
<td style="text-align:left;">
73f Clear
</td>
<td style="text-align:left;">
6m S
</td>
</tr>
<tr>
<td style="text-align:left;">
Packers
</td>
<td style="text-align:left;">
Vikings
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
2m SW
</td>
</tr>
<tr>
<td style="text-align:left;">
Colts
</td>
<td style="text-align:left;">
Jaguars
</td>
<td style="text-align:left;">
86f Humid and Mostly Cloudy
</td>
<td style="text-align:left;">
8m ESE
</td>
</tr>
<tr>
<td style="text-align:left;">
Bears
</td>
<td style="text-align:left;">
Lions
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
11m W
</td>
</tr>
<tr>
<td style="text-align:left;">
Raiders
</td>
<td style="text-align:left;">
Panthers
</td>
<td style="text-align:left;">
79f Clear
</td>
<td style="text-align:left;">
3m NE
</td>
</tr>
<tr>
<td style="text-align:left;">
Jets
</td>
<td style="text-align:left;">
Bills
</td>
<td style="text-align:left;">
65f Overcast
</td>
<td style="text-align:left;">
12m SSW
</td>
</tr>
<tr>
<td style="text-align:left;">
Browns
</td>
<td style="text-align:left;">
Ravens
</td>
<td style="text-align:left;">
75f Partly Cloudy
</td>
<td style="text-align:left;">
5m SSE
</td>
</tr>
<tr>
<td style="text-align:left;">
Seahawks
</td>
<td style="text-align:left;">
Falcons
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
3m ESE
</td>
</tr>
<tr>
<td style="text-align:left;">
Chargers
</td>
<td style="text-align:left;">
Bengals
</td>
<td style="text-align:left;">
83f Mostly Cloudy
</td>
<td style="text-align:left;">
4m WNW
</td>
</tr>
<tr>
<td style="text-align:left;">
Cardinals
</td>
<td style="text-align:left;">
49ers
</td>
<td style="text-align:left;">
71f Clear
</td>
<td style="text-align:left;">
6m NW
</td>
</tr>
<tr>
<td style="text-align:left;">
Buccaneers
</td>
<td style="text-align:left;">
Saints
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
10m ENE
</td>
</tr>
<tr>
<td style="text-align:left;">
Cowboys
</td>
<td style="text-align:left;">
Rams
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
7m W
</td>
</tr>
<tr>
<td style="text-align:left;">
Steelers
</td>
<td style="text-align:left;">
Giants
</td>
<td style="text-align:left;">
70f Clear
</td>
<td style="text-align:left;">
10m NNW
</td>
</tr>
<tr>
<td style="text-align:left;">
Titans
</td>
<td style="text-align:left;">
Broncos
</td>
<td style="text-align:left;">
78f Foggy
</td>
<td style="text-align:left;">
7m NE
</td>
</tr>
</tbody>
</table>
</div>
<div id="text-gymnastics" class="section level2">
<h2>Text Gymnastics</h2>
<p>Since the season and week fields are not included in the data, we need to extract them from the url. Remembering back to when we changed the ‘2020’ in the url to ‘2019’, we know that the position of the season portion of the url will not change. Using <code>stringr</code> and <code>str_sub</code>, we’re able to extract characters based on their position within the url - in this case characters 31-34.</p>
<p>Extracting the week out of the url is a little more complex. To start, we use regular expressions to extract all characters of the url following the ‘-’. Using <code>sub()</code>, we actually pattern match all characters prior to and including the ‘-’ and replace with ’’ (nothing). This leaves us with <code>1/</code>. From here, we just need to capture the number to serve as our week column. Here, I go back to <code>str_sub</code> and extract the characters from the right beginning with 3 characters from the right and ending with 2 characters from the right which will capture double digit weeks as well.</p>
<pre class="r"><code>url %&gt;% 
  read_html() %&gt;% 
  html_table() %&gt;%
  .[[1]] %&gt;% 
  clean_names() %&gt;%
  select(away, home, forecast, wind) %&gt;%
  mutate(season = str_sub(url, start= 31, end = 34),
         week = str_sub(gsub(&#39;.*\\-&#39;, &#39;&#39;, url), start = -3, end = -2)) %&gt;% 
  kable(format = &#39;html&#39;) %&gt;% 
  kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
away
</th>
<th style="text-align:left;">
home
</th>
<th style="text-align:left;">
forecast
</th>
<th style="text-align:left;">
wind
</th>
<th style="text-align:left;">
season
</th>
<th style="text-align:left;">
week
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Texans
</td>
<td style="text-align:left;">
Chiefs
</td>
<td style="text-align:left;">
58f Overcast
</td>
<td style="text-align:left;">
6m NNE
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Eagles
</td>
<td style="text-align:left;">
Washington
</td>
<td style="text-align:left;">
76f Partly Cloudy
</td>
<td style="text-align:left;">
4m S
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Dolphins
</td>
<td style="text-align:left;">
Patriots
</td>
<td style="text-align:left;">
73f Clear
</td>
<td style="text-align:left;">
6m S
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Packers
</td>
<td style="text-align:left;">
Vikings
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
2m SW
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Colts
</td>
<td style="text-align:left;">
Jaguars
</td>
<td style="text-align:left;">
86f Humid and Mostly Cloudy
</td>
<td style="text-align:left;">
8m ESE
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Bears
</td>
<td style="text-align:left;">
Lions
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
11m W
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Raiders
</td>
<td style="text-align:left;">
Panthers
</td>
<td style="text-align:left;">
79f Clear
</td>
<td style="text-align:left;">
3m NE
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Jets
</td>
<td style="text-align:left;">
Bills
</td>
<td style="text-align:left;">
65f Overcast
</td>
<td style="text-align:left;">
12m SSW
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Browns
</td>
<td style="text-align:left;">
Ravens
</td>
<td style="text-align:left;">
75f Partly Cloudy
</td>
<td style="text-align:left;">
5m SSE
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Seahawks
</td>
<td style="text-align:left;">
Falcons
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
3m ESE
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Chargers
</td>
<td style="text-align:left;">
Bengals
</td>
<td style="text-align:left;">
83f Mostly Cloudy
</td>
<td style="text-align:left;">
4m WNW
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Cardinals
</td>
<td style="text-align:left;">
49ers
</td>
<td style="text-align:left;">
71f Clear
</td>
<td style="text-align:left;">
6m NW
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Buccaneers
</td>
<td style="text-align:left;">
Saints
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
10m ENE
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Cowboys
</td>
<td style="text-align:left;">
Rams
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:left;">
7m W
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Steelers
</td>
<td style="text-align:left;">
Giants
</td>
<td style="text-align:left;">
70f Clear
</td>
<td style="text-align:left;">
10m NNW
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Titans
</td>
<td style="text-align:left;">
Broncos
</td>
<td style="text-align:left;">
78f Foggy
</td>
<td style="text-align:left;">
7m NE
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
</tr>
</tbody>
</table>
<p>For capturing the wind, we’ll simply remove all characters following and including the lower case ‘m’ in the wind column. This will give us the numerical representation of the wind. Similarly, for temperature we can use the same regular expression for the lower case ‘f’ in the forecast column. The weather column will be generated by removing every character prior to and including the first white space using the forecast column.</p>
<pre class="r"><code>url %&gt;% 
  read_html() %&gt;% 
  html_table() %&gt;%
  .[[1]] %&gt;% 
  clean_names() %&gt;%
  select(away, home, forecast, wind) %&gt;%
  mutate(season = str_sub(url, start= 31, end = 34),
         week = str_sub(gsub(&#39;.*\\-&#39;, &#39;&#39;, url), start = -3, end = -2),
         wind = as.numeric(gsub( &quot;m.*$&quot;, &quot;&quot;,wind)),
         temperature = ifelse(forecast == &#39;DOME&#39;, 71, gsub( &quot;f.*$&quot;, &quot;&quot;, forecast)),
         weather = gsub(&quot;.*? &quot;, &quot;&quot;, forecast)) %&gt;%
  kable(format = &#39;html&#39;) %&gt;% 
  kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
away
</th>
<th style="text-align:left;">
home
</th>
<th style="text-align:left;">
forecast
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:left;">
season
</th>
<th style="text-align:left;">
week
</th>
<th style="text-align:left;">
temperature
</th>
<th style="text-align:left;">
weather
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Texans
</td>
<td style="text-align:left;">
Chiefs
</td>
<td style="text-align:left;">
58f Overcast
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
58
</td>
<td style="text-align:left;">
Overcast
</td>
</tr>
<tr>
<td style="text-align:left;">
Eagles
</td>
<td style="text-align:left;">
Washington
</td>
<td style="text-align:left;">
76f Partly Cloudy
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
76
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Dolphins
</td>
<td style="text-align:left;">
Patriots
</td>
<td style="text-align:left;">
73f Clear
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
73
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Packers
</td>
<td style="text-align:left;">
Vikings
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Colts
</td>
<td style="text-align:left;">
Jaguars
</td>
<td style="text-align:left;">
86f Humid and Mostly Cloudy
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
86
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Bears
</td>
<td style="text-align:left;">
Lions
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Raiders
</td>
<td style="text-align:left;">
Panthers
</td>
<td style="text-align:left;">
79f Clear
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
79
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Jets
</td>
<td style="text-align:left;">
Bills
</td>
<td style="text-align:left;">
65f Overcast
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
65
</td>
<td style="text-align:left;">
Overcast
</td>
</tr>
<tr>
<td style="text-align:left;">
Browns
</td>
<td style="text-align:left;">
Ravens
</td>
<td style="text-align:left;">
75f Partly Cloudy
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
75
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Seahawks
</td>
<td style="text-align:left;">
Falcons
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Chargers
</td>
<td style="text-align:left;">
Bengals
</td>
<td style="text-align:left;">
83f Mostly Cloudy
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
83
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Cardinals
</td>
<td style="text-align:left;">
49ers
</td>
<td style="text-align:left;">
71f Clear
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Buccaneers
</td>
<td style="text-align:left;">
Saints
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Cowboys
</td>
<td style="text-align:left;">
Rams
</td>
<td style="text-align:left;">
DOME
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Steelers
</td>
<td style="text-align:left;">
Giants
</td>
<td style="text-align:left;">
70f Clear
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
70
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Titans
</td>
<td style="text-align:left;">
Broncos
</td>
<td style="text-align:left;">
78f Foggy
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
78
</td>
<td style="text-align:left;">
Foggy
</td>
</tr>
</tbody>
</table>
</div>
<div id="pivot-action" class="section level2">
<h2>Pivot Action</h2>
<p>At this point, the data is tidy’d enough to start using. However, before we move on to writing a function to scrape the data for us across multiple web pages at a time, we need to alter the orientation of the data. As is, there is a row for each game. Thinking bigger picture, we will want a row for each team - so that each row is unique for season, week, and team. Suppose you want to join or merge this weather data with a team’s box score data from one or multiple games? This final transformation will make that task much easier.</p>
<p>With the <code>pivot_longer()</code> function, we can elongate the data using the home and away columns - renaming the pivoted values column simply to ‘team’. For example, if the Texans and Chiefs played, this function ensures there is a row for each team along with the corresponding weather data from the remaining columns. What you’ll notice is that instead of 16 rows like the previous outputs, there will now be 32 (1 for each team instead of 1 for each game). The result is a clean dataset with a row for each season, week, team.</p>
<pre class="r"><code>url %&gt;% 
  read_html() %&gt;% 
  html_table() %&gt;%
  .[[1]] %&gt;% 
  clean_names() %&gt;%
  select(away, home, forecast, wind) %&gt;%
  mutate(season = str_sub(url, start= 31, end = 34),
         week = str_sub(gsub(&#39;.*\\-&#39;, &#39;&#39;, url), start = -3, end = -2),
         wind = as.numeric(gsub( &quot;m.*$&quot;, &quot;&quot;,wind)),
         temperature = ifelse(forecast == &#39;DOME&#39;, 71, gsub( &quot;f.*$&quot;, &quot;&quot;, forecast)),
         weather = gsub(&quot;.*? &quot;, &quot;&quot;, forecast)) %&gt;%
  pivot_longer(cols = c(&#39;away&#39;, &#39;home&#39;), values_to = &#39;team&#39;) %&gt;% 
  select(-name, -forecast) %&gt;% 
  select(team, season, week, temperature, wind, weather) %&gt;% 
  kable(format = &#39;html&#39;) %&gt;% 
  kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
team
</th>
<th style="text-align:left;">
season
</th>
<th style="text-align:left;">
week
</th>
<th style="text-align:left;">
temperature
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:left;">
weather
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Texans
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
58
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Overcast
</td>
</tr>
<tr>
<td style="text-align:left;">
Chiefs
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
58
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Overcast
</td>
</tr>
<tr>
<td style="text-align:left;">
Eagles
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
76
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Washington
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
76
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Dolphins
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
73
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Patriots
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
73
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Packers
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Vikings
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Colts
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
86
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Jaguars
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
86
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Bears
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Lions
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Raiders
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
79
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Panthers
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
79
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Jets
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
65
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Overcast
</td>
</tr>
<tr>
<td style="text-align:left;">
Bills
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
65
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Overcast
</td>
</tr>
<tr>
<td style="text-align:left;">
Browns
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
75
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Ravens
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
75
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Seahawks
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Falcons
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Chargers
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
83
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Bengals
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
83
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Cardinals
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
49ers
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Buccaneers
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Saints
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Cowboys
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Rams
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Steelers
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
70
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Giants
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
70
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Titans
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
78
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Foggy
</td>
</tr>
<tr>
<td style="text-align:left;">
Broncos
</td>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
78
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Foggy
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="mapping-the-function" class="section level1">
<h1>Mapping the Function</h1>
<p>The final objective here is to use this code as a function. Functions can be used over and over without rewriting code. In this example, we can use and reuse our code for existing urls, grabbing data from a particular week of a particular season - or we can run for all weeks from multiple seasons. For this blog post, we’re going to grab weather data for weeks 1 through 17 from 2018 and 2019.</p>
<p>We actually need two functions. One for generating the web page urls and another for scraping / wrangling the data. For generating the urls, we establish the sequence of weeks and years. Then, with the help of <code>tidyr</code> and the <code>crossing()</code> function, we can generate all combinations of weeks and years. The result is a tibble with two columns containing a row for weeks 1-17 for each season 2018 and 2019. The function that generates the urls simply concatenates the base url with the year and week provided. Using <code>pmap</code>, we can iterate over each row of the <code>weather_weeks_and_years</code> tibble, passing the year and week from each row into our <code>generate_urls</code> function. The result is a list of 85 urls or web pages that we can now scrape data from.</p>
<pre class="r"><code># set up weeks and years
weeks &lt;- c(1:17)
years &lt;- c(2018:2019)
weather_weeks_and_years &lt;- crossing(year = years, week = weeks) # generate all unique combinations

# function to generate urls
generate_urls &lt;- function(year, week) {
  full_url &lt;- glue::glue(&quot;http://nflweather.com/en/week/{year}/week-{week}/&quot;)
}

# pass weeks and years through function
url_list &lt;- pmap(weather_weeks_and_years, generate_urls)

head(url_list)</code></pre>
<pre><code>## [[1]]
## http://nflweather.com/en/week/2018/week-1/
## 
## [[2]]
## http://nflweather.com/en/week/2018/week-2/
## 
## [[3]]
## http://nflweather.com/en/week/2018/week-3/
## 
## [[4]]
## http://nflweather.com/en/week/2018/week-4/
## 
## [[5]]
## http://nflweather.com/en/week/2018/week-5/
## 
## [[6]]
## http://nflweather.com/en/week/2018/week-6/</code></pre>
<p>Below, we create a function that accepts a url, scrapes, wrangles, and returns the data. The code is the same code written above, used repeatedly for each url. We execute the function for each url within <code>url_list</code> by using <code>map_df</code> from the <code>purrr</code> package. <code>map_df</code> accepts an input list and applies a function to each element while returning a data frame. It might take a minute or two to run. Upon completion, you should have a solid weather dataset to start digging into.</p>
<pre class="r"><code># function to scrape weather
scrape_weather_data &lt;- function(webpage_url) {
  webpage_url %&gt;% 
    read_html() %&gt;% 
    html_table() %&gt;%
    .[[1]] %&gt;% 
    clean_names() %&gt;%
    select(away, home, forecast, wind) %&gt;%
    mutate(season = str_sub(webpage_url, start= 31, end = 34),
           week = str_sub(gsub(&#39;.*\\-&#39;, &#39;&#39;, webpage_url), start = -3, end = -2),
           wind = as.numeric(gsub( &quot;m.*$&quot;, &quot;&quot;,wind)),
           temperature = ifelse(forecast == &#39;DOME&#39;, 71, gsub( &quot;f.*$&quot;, &quot;&quot;, forecast)),
           weather = gsub(&quot;.*? &quot;, &quot;&quot;, forecast)) %&gt;%
    pivot_longer(cols = c(&#39;away&#39;, &#39;home&#39;), values_to = &#39;team&#39;) %&gt;% 
    select(-name, -forecast) %&gt;% 
    select(team, season, week, temperature, wind, weather)
}

# pass urls through the function
weather_data &lt;- map_df(url_list, scrape_weather_data)

weather_data %&gt;% 
  sample_n(10) %&gt;% 
  kable(format = &#39;html&#39;) %&gt;% 
  kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
team
</th>
<th style="text-align:left;">
season
</th>
<th style="text-align:left;">
week
</th>
<th style="text-align:left;">
temperature
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:left;">
weather
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Titans
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
44
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Overcast
</td>
</tr>
<tr>
<td style="text-align:left;">
Bengals
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
82
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Cowboys
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
83
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Drizzle
</td>
</tr>
<tr>
<td style="text-align:left;">
Buccaneers
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
71
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
DOME
</td>
</tr>
<tr>
<td style="text-align:left;">
Ravens
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
46
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
<tr>
<td style="text-align:left;">
Browns
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
82
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Chiefs
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
40
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Jets
</td>
<td style="text-align:left;">
2019
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Overcast
</td>
</tr>
<tr>
<td style="text-align:left;">
Chiefs
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
85
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Clear
</td>
</tr>
<tr>
<td style="text-align:left;">
Texans
</td>
<td style="text-align:left;">
2018
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
62
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Cloudy
</td>
</tr>
</tbody>
</table>
</div>
<div id="finally" class="section level1">
<h1>Finally</h1>
<p>That was a lot. From regular expressions, to creating functions, and using <code>purrr</code> - there were quite a few different tasks described in this post. In the wild, most data are messy and need to be gathered / cleaned using a wide variety of tricks and trades. Good bye.</p>
</div>

  
  <h4><i class="fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=%2fpost%2fgathering-historical-nfl-weather-data%2f" target="_blank" title="Share on Facebook"><i class="fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=%2fpost%2fgathering-historical-nfl-weather-data%2f&via=HorribleGeek" target="_blank" title="Tweet"><i class="fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=%2fpost%2fgathering-historical-nfl-weather-data%2f" target="_blank" title="Share on Google+"><i class="fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=%2fpost%2fgathering-historical-nfl-weather-data%2f" target="_blank" title="Post to Tumblr"><i class="fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=%2fpost%2fgathering-historical-nfl-weather-data%2f" target="_blank" title="Pin it"><i class="fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=%2fpost%2fgathering-historical-nfl-weather-data%2f" target="_blank" title="Submit to Reddit"><i class="fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/post/the-chargers-and-close-games/">The Chargers and Close Games</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/post/the-chargers-and-close-games/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="/js/ui.js"></script>
<script src="/js/menus.js"></script>






<script src="/js/math-code.js"></script>
  <script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

